# Linux下CPU使用率与机器负载的关系与区别(转)

原文链接

[Linux下CPU使用率与机器负载的关系与区别](http://blog.sina.com.cn/s/blog_6090a6ba0101kacf.html)

- CPU利用率: 显示的是程序在运行期间实时占用的CPU百分比. 

- CPU负载: 显示的是一段时间内正在使用和等待使用CPU的平均任务数. CPU利用率高, 并不意味着负载就一定大. 

使用`top`命令显示的第一行`load average`, 就是一端时间内的CPU负载, 也可以看作**系统平均负载**. 它所包含的信息不是CPU的使用率状况, 而是在一段时间内CPU正在处理以及等待CPU处理的进程数之和的统计信息, 也就是CPU使用队列的长度的统计信息. 这个数字越小越好. 

## 1. 概念理解

某公用电话亭, 有一个人在打电话, 四个人在等待, 每人限定使用电话一分钟, 若有人一分钟之内没有打完电话, 只能挂掉电话去排队, 等待下一轮d电 话在这里就相当于CPU, 而正在或等待打电话的人就相当于任务数. 

在电话亭使用过程中, 肯定会有人打完电话走掉, 有人没有打完电话而选择重新排队, 更会有新增的人在这儿排队, 这里人数的变化就相当于任务数的增减. 为了统计平均负载情况, 我们5秒钟统计一次人数, 并在第1、5、15分钟的时候对统计情况取平均值, 从而形成第1、5、15分钟的平均负载. 有的人拿起电话就打, 一直打完1分钟, 而有的人可能前三十秒在找电话号码, 或者在犹豫要不要打, 后三十秒才真正在打电话. 如果把电话看作CPU, 人数看作任务, 我们就说前一个人（任务）的CPU利用率高, 后一个人（任务）的CPU利用率低, 因为电话(CPU)没闲着. 

当然, CPU并不会在前三十秒工作, 后三十秒歇着, 只是说, 有的程序涉及到大量的计算, 所以CPU利用率就高, 而有的程序牵涉到计算的部分很少, CPU利用率自然就低. 但**无论CPU的利用率是高是低, 跟后面有多少任务在排队没有必然关系**. 

## 2. 负载为多少才算比较理想?

这个有争议, 各有各的说法, 个人比较赞同CPU负载小于等于0.5算是一种理想状态. 

不管某个CPU的性能有多好, 1秒钟能处理多少任务, 我们可以认为它无关紧要, 虽然事实并非如此. 在评估CPU负载时, 我们只以5秒钟为单位为统计任务队列长度. 如果每隔5秒钟统计的时候, 发现任务队列长度都是1, 那么CPU负载就为1. 假如我们只有一个单核的CPU, 负载一直为1, 意味着没有任务在排队, 还不错. 

上面提到的我那台服务器, 是双核双CPU, 等于是有4个内核, 每个内核的负载为1的话, 总负载为4. 这就是说, 如果我那台服务器的CPU负载长期保持在4左右, 还可以接受. 

## 3. CPU使用率到多少才算比较理想?

CPU利用率在过去常常被我们这些外行认为是判断机器是否已经到了满负荷的一个标准, 我看到长时间CPU使用率60-80%就认为机器有瓶颈出现. 