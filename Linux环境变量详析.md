# Linux环境变量详析

## 1. 哪一个文件生效?

与环境变量有关的四个文件

- `/etc/profile`

- `/etc/bashrc`

- `~/.bash_profile`

- `~/.bashrc`

为了说明哪些情况下系统会加载哪个文件中的配置, 网上大部分都扯了一些乱七八糟的东西, `login`与`nologin`, `交互式`与`非交互式`...没说到点子上. 

加载`profile`与`bashrc`其中的哪一个, 最根本的就是看, **是不是创建了新的bash shell进程**, 其他的概念在这里都没什么用.

`bashrc`, 是针对`bash shell`进程而言的, 而`profile`是针对系统中任意进程而言的. 也就是说, `bashrc`是启动一个`bash shell`时, 此shell就会加载, 取得其中的配置; 而`profile`, 以任意用户身份启动任意进程, 都可以得到其中的配置.



由于`profile`是针对任意进程都有效的, 因为对`bash shell`进程也有效, 而后者又会加载`bashrc`的配置内容, 所以`profile`中的配置在shell中一般会被`bashrc`中的配置覆盖掉.

## 1. 作用域

1. 全局作用域: 在linux系统启动后, 任意进程, 任意用户都可以访问到的变量

2. 全局bash作用域: 任意用户, 通过创建bash进程而能够访问到的变量

3. 用户级全局作用域

4. 用户级bash作用域

通过任意终端, ssh, 或是使用`su -l`选项, 都相当于开启了一个登录shell.

## 2. 生命周期

## 3. 优先级

`/etc/profile` < `~/.bash_profile`

`/etc/bashrc` < `~/.bashrc`

### 登录(login)与非登录(nologin)

普通的终端登录, ssh远程登录, 或者是`su -l`切换用户等, 称为`login`方式登录, 它们都创建了`bash`进程, 除了读取`profile`, 还会读取`bashrc`.

从桌面发行版图形界面登录, 或是通过VNC登录, 为`nologin`方式, 可能有点难以理解. 但是这些方式并没有打开实际的终端, 没有创建`bash shell`进程, 所以只会读取`profile`. 但是在这些图形界面中打开终端, 这些终端又成了`login`式的了.

### 交互式与非交互式

交互式模式就是shell等待你的输入，并且执行你键入的命令。此时shell与用户进行交互, 输入输出与终端相连。这种模式也是大多数用户非常熟悉的：终端登录、执行一些命令、退出。退出后，shell也随之终止。 

shell也可以运行在另外一种模式：非交互式模式。在这种模式下，shell不与你进行交互，而是读取存放在文件中的命令,并且执行它们。当它读到文件的结尾，shell也就终止了。典型的例子就是`crontab`定时执行脚本, 它们的输入输出不会与任何bash进程相连接.