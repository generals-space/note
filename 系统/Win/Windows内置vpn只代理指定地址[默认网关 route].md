# Windows系统vpn只代理指定地址[默认网关]

参考文章

1. [配置Windows路由表根据IP段进行VPN分流](https://blog.jtwo.me/configure-routing-table-for-vpn-diversion/)
    - 通过配置网络接口解决, 验证有效
2. [win系统vpn只代理指定地址](https://liuxingjun.github.io/2019/06/17/win%E7%B3%BB%E7%BB%9Fvpn%E5%8F%AA%E4%BB%A3%E7%90%86%E6%8C%87%E5%AE%9A%E5%9C%B0%E5%9D%80/)
    - 只通过`route`命令配置路由表
    - 单次生效: `route add    需要访问的ip(或网段) mask vpn的子网掩码 vpn接口的ip`
    - 永久生效: `route add -p 需要访问的ip(或网段) mask vpn的子网掩码 vpn接口的ip`
    - 删除: `route delete 10.10.200.23`

操作系统: win10

## 场景描述

使用windows系统内置的vpn工具, 配置网络接口后, 点击连接, 默认代理会所有地址.

查看开启vpn后的路由表

> `vpn`接口只在点击连接后, 才会出现在`ipconfig`结果列表中.

```
$ iproute print -4
IPv4 路由表
===========================================================================
活动路由:
    网络目标          网络掩码               网关      接口            跃点数
     0.0.0.0          0.0.0.0       172.18.239.1       172.18.239.36   8495
     0.0.0.0          0.0.0.0            在链路上      10.10.200.23     26
10.10.200.23  255.255.255.255            在链路上      10.10.200.23    281
```

其中`172.18.239.1`是原本的网关, `172.18.239.36`则是原本的ip, 而`10.10.200.23`则是公司内网网段, 多出了一条目标网络为`0.0.0.0`的默认路由.

但我希望只在访问公司内网时走vpn网络, 那么...手动移除第2条路由? 那每次连接都要手动执行一下这条命令?

## 解决方法

手动配置vpn接口的网络属性, 步骤如下:

1. 打开"网络和internet"设置,「更改适配器设置」, 找到刚才新建的vpn接口
2. 右击vpn接口并选择属性, 选择「安全」标签页并修改「VPN类型」
3. 选择「网络」并修改「Internet 协议版本」中4和6的「属性」的「高级」
4. 取消「IP 设置」标签页中的「在远程网络上使用默认网关」的选中状态

完成后, 再次连接vpn, 就没有默认网关的路由了.
