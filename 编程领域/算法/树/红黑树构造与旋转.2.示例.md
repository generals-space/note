参考文章

[【数据结构】红黑树插入的实例演示](https://blog.csdn.net/cout_sev/article/details/24628903)
    - 一个20节点的红黑树的构建过程及单步分析(ta也有引用别的文章, 但原文只有流程图, 没有讲解), 图示十分详细, 涉及到5种旋转.
[教你透彻了解红黑树](https://segmentfault.com/a/1190000000472153)
    - 没有涉及对**3.3.3**节中情况的处理
[30张图带你彻底理解红黑树](https://www.jianshu.com/p/e136ec79235c)
    - 明确指出**3.3.3**情况的解决方法
    - "红黑树的生长是自底向上的"意思是, 找到节点插入的位置非常简单, 但是维护树的平衡则需要从下而上遍历.

待插入节点: [12,1,9,2,0,11,7,19,4,15,18,5,14,13,10,16,6,3,8,17]

## 1. 节点12

原本的红黑树为空的, 第一个节点就是根节点, 那么直接染黑(默认新节点都是红的).

```
    12(R)            =>              12(B)
```

## 2. 节点1

```
    简化版                   nil节点版
    12(B)                     12(B)
  /                         /       \
1(R)                      1(R)      nil(B)
                        /      \
                    nil(B)    nil(B)
```

单看左侧你会发现貌似违反了第3条约束, 叶子节点不为黑. 

但是这其实是简化版的展示, 实际上在程序中存在`nil(B)`节点, 如果把ta们画出来, 就可以得到右侧的形态. 

不过带有`nil(B)`节点的图示会影响我们在之后插入过程中的旋转和变色操作, 所以默认以不带有`nil(B)`节点的树进行展示.

## 3. 节点9

```
    简化版         
    12(B)         
  /               
1(R)              
    \             
    9(R)          
```

可以看到违反了第4条约束(两个相连的红节点), 对应到插入规则的**3.2(父节点为红, 叔叔节点存在且为黑)**, 这种情况可以通过旋转解决.

```
    12(B)        =>            12(B)         =>           9(B)      
  /                           /                         /      \    
1(R)                        9(R)                     1(R)      12(R)
    \                      /                                        
    9(R)                 1(R)                                       
```

## 4. 节点2

```
     9(B)
   /      \
1(R)      12(R)
   \
   2(R)
```

现在同样是违反了第4条约束, 但此时对应的插入规则为**3.3.3(父节点为红, 叔叔节点存在且为红, 祖父节点为根节点)**

```
     9(B)          =>           9(R)            =>             9(B)      
   /      \                   /      \                       /      \    
1(R)      12(R)            1(B)      12(B)                1(B)      12(B)
   \                          \                              \           
   2(R)                       2(R)                           2(R)        
```

第1步, 把父节点1和叔叔节点12都染黑, 祖父节9点染红(交换颜色), 然后发现祖父节点9没有父节点了, ta自己是根节点. 为了满足第2条约束, 只能再把节点9染回黑色.

## 5. 节点0

```
             9(B)      
           /      \    
        1(B)      12(B)
      /     \           
   0(R)     2(R)        
```

对应插入规则**2(父节点为黑)**, 不做任何操作.

## 6. 节点11

```
              9(B)      
           /       \    
       1(B)         12(B)
     /     \        /   
  0(R)     2(R)   11(R)
```

同上

## 7. 节点7

```
              9(B)      
           /       \    
         /           \
     1(B)             12(B)
   /      \           /    
 0(R)    2(R)       11(R)  
            \              
            7(R)           
```

对应插入规则**3.3.1(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为黑)**

```
              9(B)                =>                 9(B)          
           /       \                              /       \        
         /           \                          /           \      
     1(B)             12(B)                 1(R)             12(B) 
   /      \           /                   /      \           /     
 0(R)    2(R)       11(R)               0(B)    2(B)       11(R)   
            \                                      \               
            7(R)                                   7(R)            
```

翻转父节点2, 叔叔节点0的颜色为黑, 同时翻转祖父节点1的颜色为红. 继续向上回溯, 把祖父节点1(R)当作新插入的节点, 再次对应插入规则**2. 父节点为黑**, 什么都不用做.

## 8. 节点19

```
                 9(B)               
              /       \             
            /           \           
        1(R)             12(B)      
      /      \         /       \    
    0(B)    2(B)     11(R)    19(R) 
               \                    
               7(R)                 
```

不需要多做操作.

## 9. 节点4

```
             9(B)               
          /       \             
        /           \           
    1(R)             12(B)      
  /      \         /       \    
0(B)    2(B)     11(R)    19(R) 
            \                    
            7(R)    
          /             
        4(R)
```

违反第4条约束(两个相连的红节点), 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**.

```
             9(B)                =>                  9(B)                  =>                 9(B)               
          /       \                               /       \                                /       \             
        /           \                           /           \                            /           \           
    1(R)             12(B)                  1(R)             12(B)                   1(R)             12(B)      
  /      \         /       \              /      \         /       \               /      \         /       \    
0(B)    2(B)     11(R)    19(R)         0(B)    2(B)     11(R)    19(R)          0(B)    4(B)     11(R)    19(R) 
            \                                       \                                  /      \                  
            7(R)                                    4(R)                              2(R)     7(R)              
           /                                           \                                                         
         4(R)                                           7(R)                                                     
```

## 10. 节点15

```
               9(B)               
            /       \             
          /           \           
      1(R)             12(B)      
    /      \         /       \    
  0(B)    4(B)     11(R)    19(R) 
        /      \            /     
       2(R)     7(R)      15(R)   
                                  
```

违反第4条约束(两个相连的红节点), 对应插入规则**3.3.1(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为黑)**.

```
               9(B)                =>                9(B)               
            /       \                             /       \             
          /           \                         /           \           
      1(R)             12(B)                1(R)             12(R)      
    /      \         /       \            /      \         /       \    
  0(B)    4(B)     11(R)    19(R)       0(B)    4(B)     11(B)    19(B) 
        /      \            /                 /      \            /     
       2(R)     7(R)      15(R)              2(R)     7(R)      15(R)   
                                                                        
```

交换父/叔节点与祖父节点的颜色, 然后发现祖父节点的父节点为黑色, 则不用再做其余调整.

## 11. 节点18

```
              9(B)               
           /       \             
         /           \           
     1(R)             12(R)      
   /      \         /       \    
 0(B)    4(B)     11(B)    19(B) 
       /      \            /     
      2(R)     7(R)      15(R)   
                            \    
                            18(R)
```

违反第4条约束(两个相连的红节点), 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**

```
              9(B)                   =>                9(B)                    =>                9(B)                  
           /       \                                /       \                                 /       \                
         /           \                            /           \                             /           \              
     1(R)             12(R)                   1(R)             12(R)                    1(R)             12(R)         
   /      \         /       \               /      \         /       \                /      \         /       \       
 0(B)    4(B)     11(B)    19(B)          0(B)    4(B)     11(B)    19(B)           0(B)    4(B)     11(B)    18(B)    
       /      \            /                    /      \            /                     /      \           /     \   
      2(R)     7(R)      15(R)                 2(R)     7(R)      18(R)                  2(R)     7(R)     15(R)  19(R)
                            \                                    /                                                     
                            18(R)                              15(R)                                                   
```

## 12. 节点5

```
                 9(B)                  
              /        \                
           /             \        
        /                  \
    1(R)                    12(R)         
  /      \                /       \       
0(B)    4(B)            11(B)    18(B)    
      /      \                  /     \   
    2(R)    7(R)            15(R)     19(R)
            /                     
         5(R)
```

违反第4条约束(两个相连的红节点), 对应插入规则**3.3.2(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为红)**.

先变色, 得到

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(R)                    12(R)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(B)        
         /      \                  /     \       
       2(B)    7(B)            15(R)     19(R)   
               /                                 
            5(R)                                 
```

现在节点`1(R)->4(R)`又违反了第4条约束, 对应插入规则**3.3.3(父节点为红, 叔叔节点存在且为红, 祖父节点为根节点)**.

再次变色, 得到

```
                    9(R)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(B)        
         /      \                  /     \       
       2(B)    7(B)            15(R)     19(R)   
               /                                 
            5(R)                                 
```

由于节点9为根节点, 所以还需要染回黑色.

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(B)        
         /      \                  /     \       
       2(B)    7(B)            15(R)     19(R)   
               /                                 
            5(R)                                 
```

## 13. 节点14

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(B)        
         /      \                  /     \       
       2(B)    7(B)            15(R)     19(R)   
               /               /                 
            5(R)           14(R)                 
```

再次违反第4条约束, 对应插入规则**3.3.1(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为黑)**.

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(R)        
         /      \                  /     \       
       2(B)    7(B)            15(B)     19(B)   
               /               /                 
            5(R)           14(R)                 
```

交换父节点/叔叔节点与祖父节点的颜色, 然后发现祖父节点18的父节点12为黑, 不需要再进行其他操作.

## 14. 节点13

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(R)        
         /      \                  /     \       
       2(B)    7(B)            15(B)     19(B)   
               /               /                 
            5(R)           14(R)                 
                            /                    
                        13(R)                    
```

违反第4条约束, 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**.

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(R)        
         /      \                  /     \       
       2(B)    7(B)            14(B)     19(B)   
               /               /    \            
            5(R)           13(R)   15(R)              
```

## 15. 节点10

```
                    9(B)                         
                 /        \                      
              /             \                    
           /                  \                  
       1(B)                    12(B)             
     /      \                /       \           
   0(B)    4(R)            11(B)    18(R)        
         /      \         /        /     \       
       2(B)    7(B)   10(R)     14(B)     19(B)   
               /               /    \            
            5(R)           13(R)   15(R)              
```

直接插入, 没什么好说的.

## 16. 节点16

```
             ______ 9(B) ______                  
           /                    \                  
       1(B)                      12(B)             
     /      \                  /       \           
   0(B)    4(R)              11(B)    18(R)        
         /      \           /        /     \       
       2(B)    7(B)     10(R)     14(B)     19(B)   
               /                 /    \            
            5(R)             13(R)   15(R)              
                                         \
                                         16(R)
```

违反第4条约束, 对应插入规则**3.3.2(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为红)**.

先变色

```
             ______ 9(B) ______                   
           /                    \                  
       1(B)                      12(B)             
     /      \                  /       \           
   0(B)    4(R)             11(B)     18(R)        
         /      \           /        /     \       
       2(B)    7(B)     10(R)     14(R)     19(B)  
               /                 /    \            
            5(R)             13(B)   15(B)         
                                         \
                                         16(R)
```

将祖父节点14(R)看作是新插入的节点, 此时违反第4条约束, 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**.

```
          ______ 9(B) ______                                ______ 9(B) ______                                   _______ 9(B) _______                  
        /                    \                            /                    \                               /                      \                 
    1(B)                      12(B)                   1(B)                      12(B)                      1(B)                        14(B)            
  /      \                  /       \               /      \                  /       \                  /      \                   /         \         
0(B)    4(R)             11(B)     18(R)          0(B)    4(R)             11(B)     14(R)             0(B)    4(R)              12(R)        18(R)     
      /      \           /        /     \               /      \           /        /     \                  /      \            /   \        /    \    
    2(B)    7(B)     10(R)     14(R)     19(B)        2(B)    7(B)     10(R)     13(B)     18(R)           2(B)    7(B)      11(B)   13(B)  15(B)  19(B)
            /                 /    \                          /                           /    \                    /         /               \         
         5(R)             13(B)   15(B)                    5(R)                       15(B)    19(B)              5(R)      10(R)              16(R)    
                                      \                                                   \                                                              
                                      16(R)                                               16(R)                                                          
```

## 17. 节点6

```
                         9(B)                         
                      /       \                       
                   /            \                     
                /                 \                   
             /                      \                 
         1(B)                        14(B)            
      /        \                   /        \         
    0(B)      4(R)              12(R)       18(R)     
            /      \            /   \       /    \    
          2(B)    7(B)      11(B)   13(B) 15(B)  19(B)
                   /         /              \         
                 5(R)      10(R)             16(R)    
                    \                                 
                     6(R)                             
```

违反第4条约束, 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**.

```
                         9(B)                         
                      /       \                       
                   /            \                     
                /                 \                   
             /                      \                 
         1(B)                        14(B)            
      /        \                   /        \         
    0(B)      4(R)              12(R)       18(R)     
            /      \            /   \       /    \    
          2(B)    6(B)      11(B)   13(B) 15(B)  19(B)
                 /    \       /              \         
              5(R)    7(R)  10(R)             16(R)    
```

LR型旋转分两步, 这里就不拆开展示了.

## 18. 节点3

```
                    ___________________ 9(B) __________________                         
                  /                                             \                       
      _______ 1(B) _______                               ______ 14(B) ______            
    /                      \                           /                     \          
 0(B)                     4(R)                     12(R)                     18(R)      
                      /          \               /       \                 /       \    
                   2(B)          6(B)        11(B)       13(B)           15(B)     19(B)
                       \        /    \        /                            \            
                       3(R)   5(R)    7(R)  10(R)                           16(R)       
```

父节点为黑, 不需要操作.

## 19. 节点8

树太宽了, 下面只画左子树.

```
         1(B)                 
      /        \               
  0(B)         4(R)             
           /          \         
        2(B)          6(B)      
            \        /    \     
            3(R)   5(R)    7(R) 
                             \
                             8(R)
```

违反了第4条约束, 对应插入规则**3.3.2(父节点为红, 叔叔节点存在且为红, 祖父节点的父节点为红)**.

仍然是先变色.

```
         1(B)                     
      /        \                  
  0(B)          4(R)              
             /        \           
         2(B)          6(R)       
             \        /    \      
             3(R)   5(B)    7(B)  
                              \   
                              8(R)
```

现在把节点6(R)看作是新插入节点, 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**. 只靠旋转即可解决.

```
         1(B)                         =>                   ____ 4(B) ____                  
      /        \                                         /                \                
  0(B)          4(R)                                 1(R)                  6(R)            
             /        \                            /      \              /      \          
         2(B)          6(R)                     0(B)      2(B)        5(B)      7(B)       
             \        /    \                                  \                     \      
             3(R)   5(B)    7(B)                              3(R)                   8(R)  
                              \                
                              8(R)             
```

现在树的总体形态如下

```
                    ___________________ 9(B) __________________                        
                  /                                             \                      
           ____ 4(B) ____                                ______ 14(B) _____            
         /                \                            /                    \          
     1(R)                  6(R)                    12(R)                    18(R)      
   /      \              /      \                /       \                /       \    
0(B)      2(B)        5(B)      7(B)         11(B)       13(B)          15(B)     19(B)
              \                     \         /                           \            
              3(R)                   8(R)   10(R)                          16(R)       
```

## 20. 节点17

这次操作只画右子树

```
                    简化版                                              nil节点版
              ______ 14(B) _____                                  ______ 14(B) ______            
            /                    \                              /                     \          
        12(R)                    18(R)                      12(R)                     18(R)      
      /       \                /       \                  /       \                 /       \    
  11(B)       13(B)          15(B)     19(B)          11(B)       13(B)           15(B)     19(B)
   /                           \                       /                         /     \            
 10(R)                          16(R)                10(R)                  nil(B)      16(R)       
                                  \                                                        \         
                                   17(R)                                                    17(R)    
```

违反第4条约束, 对应插入规则**3.2(父节点为红, 叔叔节点存在且为黑)**. 叔叔节点其实是`nil(B)`节点, 右侧给出示意图.

```
              ______ 14(B) _____                                 ______ 14(B) _____             
            /                    \                             /                    \           
        12(R)                    18(R)                     12(R)                    18(R)       
      /       \                /       \                 /       \                /       \     
  11(B)       13(B)          15(B)     19(B)         11(B)       13(B)          16(B)     19(B) 
   /                           \                      /                        /     \          
 10(R)                          16(R)               10(R)                 15(R)       17(R)     
                                  \                                                             
                                   17(R)                                                        
```

## 完成

最终的红黑树形态如下

```
                    ___________________ 9(B) __________________                        
                  /                                             \                      
           ____ 4(B) ____                                ______ 14(B) ______           
         /                \                            /                     \          
     1(R)                  6(R)                    12(R)                     18(R)      
   /      \              /      \                /       \                 /       \    
0(B)      2(B)        5(B)      7(B)         11(B)       13(B)           16(B)     19(B)
              \                     \         /                         /     \         
              3(R)                   8(R)   10(R)                  15(R)       17(R)    
```

OK

前序遍历: 9B 4B 1R 0B 2B 3R 6R 5B 7B 8R 14B 12R 11B 10R 13B 18R 16B 15R 17R 19B
中序遍历: 0B 1R 2B 3R 4B 5B 6R 7B 8R 9B 10R 11B 12R 13B 14B 15R 16B 17R 18R 19B
